<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>app/components/exp-lookit-games/discreteCatchLift.js - ember-lookit-frameplayer</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="https://yui-s.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="https://yui-s.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">
<div id="doc">
    <div id="bd" class="yui3-g">
        <div class="yui3-u-1-5">
            <div id="docs-sidebar" class="sidebar apidocs">
              <h2 style="display:inline;">
              <div>
                <img style="float:right; vertical-align:middle;" src="../assets/css/logo.png" height="70">
                <span>Lookit<br> component<br> docs</span>
              </div>

              </h2>


              <div id="api-list">
                  <div id="api-tabview">
              
                    <div id="api-tabview-panel">
                        <h2 class="off-left">Collections</h2>
                        <ul id="api-modules" class="apis modules">
                            <li class="module-sidebar-components"><a href="../modules/components.html">components</a></li>
                            <li class="module-sidebar-exp-player"><a href="../modules/exp-player.html">exp-player</a></li>
                            <li class="module-sidebar-frames"><a href="../modules/frames.html">frames</a></li>
                            <li class="module-sidebar-games"><a href="../modules/games.html">games</a></li>
                            <li class="module-sidebar-mixins"><a href="../modules/mixins.html">mixins</a></li>
                            <li class="module-sidebar-randomizers"><a href="../modules/randomizers.html">randomizers</a></li>
                            <li class="module-sidebar-services"><a href="../modules/services.html">services</a></li>
                        </ul>
                        <h2 class="off-left">All elements</h2>
                              <div id="api-tabview-filter">
                      <input type="search" id="api-filter" placeholder="Type to filter">
                    </div>
                        <ul id="api-classes" class="apis classes">
                            <li><a href="../classes/Base.html">Base</a></li>
                            <li><a href="../classes/ButtonPressWindow.html">ButtonPressWindow</a></li>
                            <li><a href="../classes/DiscreteBounce.html">DiscreteBounce</a></li>
                            <li><a href="../classes/DiscreteButtonSpatial.html">DiscreteButtonSpatial</a></li>
                            <li><a href="../classes/DiscreteCatch.html">DiscreteCatch</a></li>
                            <li><a href="../classes/DiscreteCatchLift.html">DiscreteCatchLift</a></li>
                            <li><a href="../classes/Exp-exit-survey.html">Exp-exit-survey</a></li>
                            <li><a href="../classes/Exp-frame-base.html">Exp-frame-base</a></li>
                            <li><a href="../classes/Exp-frame-select.html">Exp-frame-select</a></li>
                            <li><a href="../classes/Exp-lookit-dialogue-page.html">Exp-lookit-dialogue-page</a></li>
                            <li><a href="../classes/Exp-lookit-exit-survey.html">Exp-lookit-exit-survey</a></li>
                            <li><a href="../classes/Exp-lookit-geometry-alternation.html">Exp-lookit-geometry-alternation</a></li>
                            <li><a href="../classes/Exp-lookit-geometry-alternation-open.html">Exp-lookit-geometry-alternation-open</a></li>
                            <li><a href="../classes/Exp-lookit-instructions.html">Exp-lookit-instructions</a></li>
                            <li><a href="../classes/Exp-lookit-mood-questionnaire.html">Exp-lookit-mood-questionnaire</a></li>
                            <li><a href="../classes/Exp-lookit-observation.html">Exp-lookit-observation</a></li>
                            <li><a href="../classes/Exp-lookit-preferential-looking.html">Exp-lookit-preferential-looking</a></li>
                            <li><a href="../classes/Exp-lookit-preview-explanation.html">Exp-lookit-preview-explanation</a></li>
                            <li><a href="../classes/Exp-lookit-story-page.html">Exp-lookit-story-page</a></li>
                            <li><a href="../classes/Exp-lookit-survey.html">Exp-lookit-survey</a></li>
                            <li><a href="../classes/Exp-lookit-text.html">Exp-lookit-text</a></li>
                            <li><a href="../classes/Exp-lookit-video.html">Exp-lookit-video</a></li>
                            <li><a href="../classes/Exp-lookit-video-assent.html">Exp-lookit-video-assent</a></li>
                            <li><a href="../classes/Exp-lookit-video-consent.html">Exp-lookit-video-consent</a></li>
                            <li><a href="../classes/Exp-player.html">Exp-player</a></li>
                            <li><a href="../classes/Exp-video-config.html">Exp-video-config</a></li>
                            <li><a href="../classes/Exp-video-config-quality.html">Exp-video-config-quality</a></li>
                            <li><a href="../classes/Exp-video-consent.html">Exp-video-consent</a></li>
                            <li><a href="../classes/Exp-video-preview.html">Exp-video-preview</a></li>
                            <li><a href="../classes/Expand-assets.html">Expand-assets</a></li>
                            <li><a href="../classes/ExpFrameGamesComponent.html">ExpFrameGamesComponent</a></li>
                            <li><a href="../classes/Full-screen.html">Full-screen</a></li>
                            <li><a href="../classes/Game.html">Game</a></li>
                            <li><a href="../classes/Media-reload.html">Media-reload</a></li>
                            <li><a href="../classes/Permute.html">Permute</a></li>
                            <li><a href="../classes/Random-parameter-set.html">Random-parameter-set</a></li>
                            <li><a href="../classes/Select.html">Select</a></li>
                            <li><a href="../classes/Session-record.html">Session-record</a></li>
                            <li><a href="../classes/Utils
              Shared Utility class for project static methods and constants.html">Utils
              Shared Utility class for project static methods and constants</a></li>
                            <li><a href="../classes/Video-record.html">Video-record</a></li>
                            <li><a href="../classes/video-recorder.html">video-recorder</a></li>
                        </ul>
                    </div>
              
                  </div>
              </div>
            </div>
        </div>
        <div class="yui3-u-4-5">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: app/components/exp-lookit-games/discreteCatchLift.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
 * Developed by Gleb Iakovlev on 5/3/19 9:09 PM.
 * Last modified 4/29/19 11:02 PM.
 * Copyright (c) Cognoteq Software Solutions 2019.
 * All rights reserved
 */

import Base from &#x27;./base&#x27;;


/**
 *
 * @submodule games
 *
 */
const TOTAL_ROUNDS = 20;
let target = {}; // Current target (rat)  position parameters
let clockObject = {}; //  Object symbolizes clock (pizza) location parameters
let basket = {}; // Paddle (basket) position parameters
let initBallY = 0.27; // Initial Y ball location
let initX = 1.33; // Initial X ball location
let initialTime = 0; // Initial time for current game trial
let jitterT = 0; // Time jitter (variates from 500 ms to 1500 ms), time between sound start and ball starting to fly

// Media arrays for loading
let sounds = [];
let soundURLs = [];
let imageURLs = [];
let images = [];

// Media mapping as Enum
const gameSound = {
  START: 0,
  SERIES1: 1,
  SERIES2: 2,
  SERIES3: 3,
  SWOOSH: 4,
  FAIL: 5
};
const gameImage = {
  PADDLE: 0,
  TARGET: 1,
  CLOCK: 2,
  CLOCK_EMPTY: 3
};

/**
 *  * Main implementation of Catch the target game.
 * The user will with paddle (basket) to catch the target.
 * The target will appear with some unpredictable  delay.
 * The user should catch the target until object symbolizing the clock is gone.
 * @class DiscreteCatchLift
 * @extends Base
 */
export default class DiscreteCatchLift extends Base {
  /**
   * @method constructor
   * @constructor constructor
   * @param context Context of the game
   * @param document
   */
  constructor(context, document) {

    super(context, document);
    super.setMaxTrials(TOTAL_ROUNDS);
    soundURLs = [super.Utils.drumRollSound, super.Utils.cheese_ser1Sound, super.Utils.cheese_ser2Sound, super.Utils.cheese_ser3Sound, super.Utils.swooshSound, super.Utils.ballcatchFailSound] ;
    imageURLs = [super.Utils.rectangleCage, super.Utils.rat, super.Utils.pizza,super.Utils.cheeseMissedImage];
  }


  /**
   *
   * Main point to start the game.
   * Initialize initial parameters and preload sounds here
   * @method init
   */
  init() {
    document.addEventListener(&quot;mousemove&quot;, super.onMouseMove);

    super.fillAudioArray(soundURLs,sounds);
    super.fillImageArray(imageURLs,images);

    //Target coordinate
    let leftBorder = (initX - 0.08) * super.Utils.SCALE;
    let topBorder = (1.2971 - initBallY) * super.Utils.SCALE;

    target = {
      dimensions: {width: 0.18 * super.Utils.SCALE, height: 0.18 * super.Utils.SCALE},
      position: {x: leftBorder, y: topBorder},
      radius: 0.09525 * super.Utils.SCALE,
      delay: 2000,
      state: &#x27;start&#x27;,
      showTime: 0,
      lastTime: new Date().getTime()
    };


    basket = {
      dimensions: {width: 0, height: 0},
      position: {
        x: 0,
        y: 0
      },
      positions: [],
      times: [],
      moved: 0,
      paddleLastMovedMillis: 0
    };


    this.setClockObject();

    sounds[gameSound.START].addEventListener(&#x27;onloadeddata&#x27;, this.initGame(), false);
    sounds[gameSound.START].addEventListener(&#x27;playing&#x27;, function () {
      initialTime = new Date().getTime();

    });

    super.init();

  }


  setClockObject() {

    //Clock coord
    let leftBorder = (1.53)*super.Utils.SCALE ;
    let topBorder = (1.2974-initBallY)*super.Utils.SCALE;
    let width = 0.27777 * super.Utils.SCALE;
    let height = 0.26031 * super.Utils.SCALE;

    clockObject = {
      dimensions: {width: width, height: height},
      position: {x: leftBorder ,y: topBorder},
      angle: 0,
      state:10,
      velocity: 1.4
    };

  }



  /**
   *
   * Initialize each game round with initial object parameters
   * Randomize number of obstructions
   * Reset the sounds sources for older browser versions
   * @method initGame
   */
  initGame() {
    initialTime = 0;
    jitterT = super.trialStartTime();
    target.state = &#x27;start&#x27;;
    target.lastTime = new Date().getTime();

    this.setClockObject();
    super.createPaddleBox();
    basket = super.basketObject(basket);
    if (super.currentRounds &gt; 0 || (super.currentRounds === 0 &amp;&amp; !super.paddleIsMoved(basket))) {
      sounds[gameSound.START].play();
    }

    super.initGame();
  }


  /**
   * @method  dataCollection Collect data
   */
  dataCollection() {
    super.dataCollection();
    let exportData = {
      game_type: &#x27;discreteCatchLift&#x27;,
      basket_x: basket.position.x / this.canvas.width,
      basket_y: (this.canvas.height - basket.position.y) / this.canvas.height,
      mice_x: target.position.x / this.canvas.width,
      mice_y: (this.canvas.height - target.position.y) / this.canvas.height,
      trial: super.currentRounds,
      mice_state: target.state,
      timestamp: super.getElapsedTime(initialTime)

    };

    super.storeData(exportData);

  }


  /**
   *  Show clock  portion according to angle
   *  @method showClock
   */
  showClock() {

    let angle = Math.PI * (0.2 * clockObject.state);
    this.ctx.beginPath();
    let margin = clockObject.dimensions.width * 0.2;
    this.ctx.moveTo(clockObject.position.x + clockObject.dimensions.width / 2, clockObject.position.y + clockObject.dimensions.height / 2);
    this.ctx.fillStyle = super.Utils.blackColor;
    this.ctx.arc(clockObject.position.x + clockObject.dimensions.width / 2, clockObject.position.y + clockObject.dimensions.height / 2, clockObject.dimensions.height / 2 + margin, angle, Math.PI * 2, false);
    this.ctx.lineTo(clockObject.position.x + clockObject.dimensions.width / 2, clockObject.position.y + clockObject.dimensions.height / 2);
    this.ctx.fill();
    this.ctx.closePath();
    this.ctx.restore();
  }


  clockState() {

    let time = super.getElapsedTime(target.showTime);
    //This could be improved with simple math function
    if (time &lt; 0.1) {
      clockObject.state = 9;
    } else if (time &lt; 0.2) {
      clockObject.state = 8;
    } else if (time &lt; 0.3) {

      clockObject.state = 7;
    } else if (time &lt; 0.4) {

      clockObject.state = 6;
    } else if (time &lt; 0.5) {

      clockObject.state = 5;
    } else if (time &lt; 0.6) {

      clockObject.state = 4;
    } else if (time &lt; 0.7) {

      clockObject.state = 3;
    } else if (time &lt; 0.8) {

      clockObject.state = 2;

    } else if (time &lt; 0.9) {

      clockObject.state = 1;

    } else {
      clockObject.state = 0;
    }
    this.showClock();
  }


  /**
   *
   * Main loop of the game.
   * Set initial position of the ball in a box and starting  sound .
   * After that  start showing the target.
   * Increase the score if paddle  hits the target.
   * @method loop
   */
  loop() {
    super.loop();
    let paddleBoxColor = super.Utils.blueColor;
    super.createPaddleBox(paddleBoxColor);
    basket = super.basketObject(basket);
    super.paddleMove(basket, initialTime, target);
    super.drawImageObject(clockObject, images[gameImage.CLOCK]);

    if (initialTime === 0 &amp;&amp; super.currentRounds === 0 &amp;&amp; !super.paddleIsMoved(basket)) {

      sounds[gameSound.START].play();
    }


    if (initialTime &gt; 0 &amp;&amp; super.paddleIsMoved(basket) &amp;&amp; target.state === &#x27;start&#x27;) {
      initialTime = new Date().getTime();
      paddleBoxColor = super.Utils.redColor;
      super.createPaddleBox(paddleBoxColor);
    }

    //Randomize initial wait time here
    if (target.state === &#x27;start&#x27; &amp;&amp; initialTime &gt; 0 &amp;&amp; super.getElapsedTime(initialTime) &gt; jitterT) {
      sounds[gameSound.START].pause();
      sounds[gameSound.START].currentTime = 0;
      target.state = &#x27;show&#x27;;
      target.showTime = new Date().getTime();
    }

    if (target.state === &#x27;show&#x27;) {
      this.clockState();
      super.drawImageObject(target, images[gameImage.TARGET]);

    }

    if (target.state === &#x27;done&#x27;) {


      super.paddleAtZero(basket, false);


    }

    if (target.state === &#x27;show&#x27;) {


      if (target.showTime &gt; 0 &amp;&amp; super.getElapsedTime(target.showTime) &gt; 1) {

        target.state = &#x27;done&#x27;;
        sounds[gameSound.FAIL].play();
      }


      if (basket.moved === 0 &amp;&amp; basket.positions.length &gt; 5 &amp;&amp; basket.position.y - target.position.y &lt;= 100) {

        sounds[gameSound.SWOOSH].play();
        basket.moved = 1;

      }


      if ((target.position.y + 0.0476 * super.Utils.SCALE) - basket.position.y &gt;= 0) {
        target.state = &#x27;done&#x27;;
        if (clockObject.state &gt; 0) {
          if (clockObject.state &lt; 4) {
            sounds[gameSound.SERIES1].play();
          } else if (clockObject.state &gt;= 4 &amp;&amp; clockObject.state &lt; 8) {
            sounds[gameSound.SERIES2].play();
          } else {
            sounds[gameSound.SERIES3].play();
          }
          super.increaseScore();
          this.showClock();

        }


      }


    }

    this.showClock();
    this.drawImage(basket, images[gameImage.PADDLE]);
  }

}

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
